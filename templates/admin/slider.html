{% extends "Base.html" %}
{% block head %}
    <title>admin | slider</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='libraries/sweetalert2/sweetalert2.min.css') }}">
    <script defer src="{{ url_for('static', filename='libraries/sweetalert2/sweetalert2.all.min.js') }}"></script>
    <style>
        table * {
            border: 2px black solid;  
        }
    </style>
{% endblock %}
{% block body %}

<form action="#" method="post" id="form" enctype="multipart/form-data">

    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input type="hidden" name="mode" id="mode" value="add">
    
    <label for="slide" id="L-slide"></label>
    <input type="file" name="slide" id="slide">

    <label for="head" id="L-head"></label>
    <input type="text" name="head" id="head" placeholder="برای مثال : نفرات برتر امتحانات">

    <label for="text" id="L-text"></label>
    <textarea form="form" name="text" id="text" cols="70" rows="4" maxlength="200" placeholder="برای مثال : بعد از تصحیح برگه ها، بالاخره نتایج امتحانات اعلام شد"></textarea>

    <label for="active" id="L-active"></label>
    <input type="checkbox" name="active" id="active" value="active">

    
    <button type="submit" id="submit">ثبت اسلاید</button>
</form>


<br>
<br>
<div class="a" style="display: flex; justify-content:center">

    <div id="carouselExampleAutoplaying" class="carousel slide w-50" data-bs-ride="carousel">

        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="/static/slides/main.jpg" class="d-block w-100" alt="poster">
            </div>
            {% for s in slides %}
            {% if s.active == 1 %}
            <div class="carousel-item">
                <img src="/static/slides/{{s.id}}.jpg" class="d-block w-100" alt="slide">
                <div class="carousel-caption d-none d-md-block" style="background-color: rgba(0, 0, 0, 0.444);">
                    <h5>{{s.head}}</h5>
                    <p class="text-break m-3">{{s.text}}</p>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">قبلی</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">بعدی</span>
        </button>
    </div>
</div>
<br>
<br>
<table>
    <tr>
        <th>عنوان</th>
        <th>توضیحات</th>
        <th>فعال</th>
        <th>ویرایش</th>
        <th>حذف</th>
    </tr>
    {% for s in slides %}
    <tr id="{{s.id}}" class="slide{{s.id}}">
        <td>{{s.head}}</td>
        <td class="area_text">{{s.text}}</td>
        <td>{{"فعال" if s.active==1 else "غیر فعال"}}</td>
        <td onclick="edit(this)">ویرایش</td>
        <td>
            <input type="button" value="Eliminar"
            onclick="del_class(this,{{s.id}})">
        </td>
    </tr>
    {% endfor %}
</table>
<br><br>
<a href="/admin/dashboard"> بازگشت</a>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>


<script type="module">
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                {% if message == "edit success"%}
                swal({
                    title: 'ویرایش اسلاید!',
                    html: 'اسلاید مورد نظر با موفقیت ویرایش شد.',
                    type: 'success',
                    confirmButtonColor: '#3f9b0b',
                    confirmButtonText: '<div style="direction:rtl;font-size:18px;font-family:Iran,Calibri;font-weight:bold;"><i style="margin-left: 5px;" class="fa fa-times"></i> تائید</div>',
                    showCloseButton: true,
                    showLoaderOnConfirm:true,
                    allowOutsideClick:false,
                }).then((result) => {swal.close();})


                {%elif message == "add success"%}
                swal({
                    title: 'اسلاید جدید!',
                    html: 'اسلاید مورد نظر با موفقیت اضافه شد.',
                    type: 'success',
                    confirmButtonColor: '#3f9b0b',
                    confirmButtonText: '<div style="direction:rtl;font-size:18px;font-family:Iran,Calibri;font-weight:bold;"><i style="margin-left: 5px;" class="fa fa-times"></i> تائید</div>',
                    showCloseButton: true,
                    showLoaderOnConfirm:true,
                    allowOutsideClick:false,
                }).then((result) => {swal.close();})

                
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endwith %}
</script>








<script>
    document.querySelector("#mode").value = "add";

    function edit(e) {
        const row = e.parentNode;
        const id = row.id;

        
        const head = row.children[0].innerText;
        const text = row.children[1].innerText;
        const active = row.children[2].innerText;

        document.querySelector("#submit").innerText = "ویرایش اسلاید";
        document.querySelector("#mode").value = id;


        document.querySelector("#head").value = head;
        document.querySelector("#text").innerText = text;
        if(active=="فعال"){
            document.querySelector("#active").checked = true;
        }else{
            document.querySelector("#active").checked = false;
        }

        document.querySelector("#slide").style.display = "none"
    };



    function del_class(e,id){
        swal({
            title: 'آیا از حذف این اسلاید اطمینان دارید؟',
            html: 'می توانید این اسلاید را غیر فعال کنید تا بعدا از آن استفاده نمائید!',
            type: 'warning',
            reverseButtons: true,
            showCancelButton: true,
            confirmButtonColor: '#dc1225',
            confirmButtonText: '<div style="direction:rtl;font-size:18px;font-family:Iran,Calibri;font-weight:bold;"><i style="margin-left: 5px;" class="fa fa-times"></i> تایید</div>',
            cancelButtonText: '<div style="direction:rtl;font-size:18px;font-family:Iran,Calibri;font-weight:bold;border: 3 solid #ffd700;"><i style="margin-left: 5px;" class="fa fa-times"></i> انصراف</div>',
            showLoaderOnConfirm:true,
            allowOutsideClick:false,
            showCloseButton: false,
            focusConfirm: true,
        }).then((result) => {
        if(result.value){
            const xhr = new XMLHttpRequest();
            var url = '/admin/dashboard/slider/'+id+'?status=true'
            xhr.open('GET',url, true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send();
            e.parentNode.parentNode.style.display = "none";
            swal({
                title: 'حذف اسلاید!',
                html: 'اسلاید مورد نظر با موفقیت حذف شد.',
                type: 'success',
                confirmButtonColor: '#3f9b0b',
                confirmButtonText: '<div style="direction:rtl;font-size:18px;font-family:Iran,Calibri;font-weight:bold;"><i style="margin-left: 5px;" class="fa fa-times"></i> تائید</div>',
                showLoaderOnConfirm:true,
                allowOutsideClick:false,
            }).then((result) => {swal.close();
                setInterval(function() {
                    location.reload();
                }, 250);
            })  
        };
      });
    }

</script>

{% endblock %}